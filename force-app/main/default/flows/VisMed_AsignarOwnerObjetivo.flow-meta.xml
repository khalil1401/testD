<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <apiVersion>55.0</apiVersion>
    <assignments>
        <name>VisMed_AsignarAPM</name>
        <label>Asignar APM</label>
        <locationX>952</locationX>
        <locationY>1694</locationY>
        <assignmentItems>
            <assignToReference>apmcontact</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>VisMed_ObtenerAPMContacto.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>VisMed_APMEncontrado</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>VisMed_AsignarOwnerAdultosInstituciones</name>
        <label>Asignar Owner Adultos Instituciones</label>
        <locationX>50</locationX>
        <locationY>638</locationY>
        <assignmentItems>
            <assignToReference>VisMed_ObtenerObjetivo.OwnerId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>VisMed_ObtenerColaAdultos.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>VisMed_ObtenerObjetivo.Dan360_AsignarObjetivo__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>VisMed_AsignarObjetivo</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>VisMed_ActualizarOwner</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>VisMed_AsignarOwnerAlergia</name>
        <label>Asignar Owner Alergia</label>
        <locationX>842</locationX>
        <locationY>638</locationY>
        <assignmentItems>
            <assignToReference>VisMed_ObtenerObjetivo.OwnerId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>VisMed_ObtenerColaAlergia.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>VisMed_ObtenerObjetivo.Dan360_AsignarObjetivo__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>VisMed_AsignarObjetivo</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>VisMed_ActualizarOwner</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>VisMed_AsignarOwnerNicho</name>
        <label>Asignar Owner Nicho</label>
        <locationX>314</locationX>
        <locationY>638</locationY>
        <assignmentItems>
            <assignToReference>VisMed_ObtenerObjetivo.OwnerId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>VisMed_ObtenerColaNicho.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>VisMed_ObtenerObjetivo.Dan360_AsignarObjetivo__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>VisMed_AsignarObjetivo</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>VisMed_ActualizarOwner</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>VisMed_AsignarOwnerPaeds</name>
        <label>Asignar Owner Paeds</label>
        <locationX>578</locationX>
        <locationY>638</locationY>
        <assignmentItems>
            <assignToReference>VisMed_ObtenerObjetivo.OwnerId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>VisMed_ObtenerColaPaeds.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>VisMed_ObtenerObjetivo.Dan360_AsignarObjetivo__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>VisMed_AsignarObjetivo</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>VisMed_ActualizarOwner</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>VisMed_APMEncontrado</name>
        <label>¿APM encontrado?</label>
        <locationX>952</locationX>
        <locationY>1814</locationY>
        <defaultConnector>
            <targetReference>VisMed_RecorrerUsuariosDeLaCola</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Dan360_Encontrado</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>apmcontact</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Objetivo_Por_Cuenta_SF</targetReference>
            </connector>
            <label>Encontrado</label>
        </rules>
    </decisions>
    <decisions>
        <name>VisMed_ColaAsignada</name>
        <label>¿Cola Asignada?</label>
        <locationX>578</locationX>
        <locationY>398</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>VisMed_Adultos</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>VisMed_AsignarObjetivo</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Adultos</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>VisMed_ObtenerColaAdultos</targetReference>
            </connector>
            <label>Adultos</label>
        </rules>
        <rules>
            <name>VisMed_Nicho</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>VisMed_AsignarObjetivo</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Nicho</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>VisMed_ObtenerColaNicho</targetReference>
            </connector>
            <label>Nicho</label>
        </rules>
        <rules>
            <name>VisMed_Paeds</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>VisMed_AsignarObjetivo</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Paeds</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>VisMed_ObtenerColaPaeds</targetReference>
            </connector>
            <label>Paeds</label>
        </rules>
        <rules>
            <name>VisMed_Alergia</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>VisMed_AsignarObjetivo</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Alergia</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>VisMed_ObtenerColaAlergia</targetReference>
            </connector>
            <label>Alergia</label>
        </rules>
    </decisions>
    <decisions>
        <name>Ya_existe</name>
        <label>Ya existe?</label>
        <locationX>798</locationX>
        <locationY>2054</locationY>
        <defaultConnector>
            <targetReference>VisMed_RecorrerUsuariosDeLaCola</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Resultado predeterminado</defaultConnectorLabel>
        <rules>
            <name>No</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Objetivo_Por_Cuenta_SF</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>VisMed_CrearObjetivoCuenta</targetReference>
            </connector>
            <label>No</label>
        </rules>
    </decisions>
    <description>Flujo que asigna a una cola el objetivo</description>
    <dynamicChoiceSets>
        <name>ListaDeColas</name>
        <dataType>Picklist</dataType>
        <displayField xsi:nil="true"/>
        <object xsi:nil="true"/>
        <picklistField>Dan360_AsignarObjetivo__c</picklistField>
        <picklistObject>VisMed_Objetivo__c</picklistObject>
    </dynamicChoiceSets>
    <environments>Default</environments>
    <formulas>
        <name>VisMed_AsignarEstadoObjetivoAccion</name>
        <dataType>String</dataType>
        <expression>IF(TODAY() &gt; {!VisMed_ObtenerObjetivo.VisMed_FechaFin__c}, &apos;Inactivo&apos;,
     IF(TODAY() &lt; {!VisMed_ObtenerObjetivo.VisMed_FechaInicio__c}, &apos;Pendiente&apos;,  
         IF(TODAY() &gt;= {!VisMed_ObtenerObjetivo.VisMed_FechaInicio__c} &amp;&amp; TODAY() &lt;= {!VisMed_ObtenerObjetivo.VisMed_FechaFin__c}, &apos;Activo&apos;,Null
             )
       )
 )</expression>
    </formulas>
    <interviewLabel>Asignar Owner a Objetivo {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Asignar Owner a Objetivo</label>
    <loops>
        <name>VisMed_RecorrerUsuariosDeLaCola</name>
        <label>Recorrer Usuarios de la Cola</label>
        <locationX>578</locationX>
        <locationY>1334</locationY>
        <collectionReference>VisMed_ListadoDeUsuarios</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>VisMed_ObtenerUsuario</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>VisMed_ObjetivosPorCuentaCreados</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>Flow</processType>
    <recordCreates>
        <name>VisMed_CrearObjetivoCuenta</name>
        <label>Crear Objetivo Por Cuenta</label>
        <locationX>666</locationX>
        <locationY>2174</locationY>
        <connector>
            <targetReference>VisMed_RecorrerUsuariosDeLaCola</targetReference>
        </connector>
        <inputAssignments>
            <field>Estado__c</field>
            <value>
                <elementReference>VisMed_AsignarEstadoObjetivoAccion</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>VisMed_APMContacto__c</field>
            <value>
                <elementReference>apmcontact</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>VisMed_Objetivo__c</field>
            <value>
                <elementReference>VisMed_ObtenerObjetivo.Id</elementReference>
            </value>
        </inputAssignments>
        <object>VisMed_ObjetivoPorCuenta__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordLookups>
        <name>Objetivo_Por_Cuenta_SF</name>
        <label>Objetivo Por Cuenta SF</label>
        <locationX>798</locationX>
        <locationY>1934</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Ya_existe</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>VisMed_Objetivo__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>VisMed_ObtenerObjetivo.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>VisMed_APMContacto__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>apmcontact</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>VisMed_ObjetivoPorCuenta__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>VisMed_ListadoDeUsuarios</name>
        <label>Listado de Usuarios</label>
        <locationX>578</locationX>
        <locationY>1214</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>VisMed_RecorrerUsuariosDeLaCola</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>GroupId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>VisMed_ObtenerObjetivo.OwnerId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>GroupMember</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>VisMed_ObtenerAPMContacto</name>
        <label>Obtener APM Contacto</label>
        <locationX>952</locationX>
        <locationY>1574</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>VisMed_AsignarAPM</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>VisMed_ObtenerUsuario.ContactId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Contact</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>VisMed_ObtenerColaAdultos</name>
        <label>Obtener Cola Adultos</label>
        <locationX>50</locationX>
        <locationY>518</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>VisMed_AsignarOwnerAdultosInstituciones</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>VisMed_Adultos</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Group</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>VisMed_ObtenerColaAlergia</name>
        <label>Obtener Cola Alergia</label>
        <locationX>842</locationX>
        <locationY>518</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>VisMed_AsignarOwnerAlergia</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>VisMed_Alergia</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Group</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>VisMed_ObtenerColaNicho</name>
        <label>Obtener Cola Nicho</label>
        <locationX>314</locationX>
        <locationY>518</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>VisMed_AsignarOwnerNicho</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>VisMed_Nicho</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Group</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>VisMed_ObtenerColaPaeds</name>
        <label>Obtener Cola Paeds</label>
        <locationX>578</locationX>
        <locationY>518</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>VisMed_AsignarOwnerPaeds</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>VisMed_Paeds</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Group</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>VisMed_ObtenerObjetivo</name>
        <label>Obtener Objetivo</label>
        <locationX>578</locationX>
        <locationY>158</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Seleccionar_Valores</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>VisMed_Objetivo__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>VisMed_ObtenerUsuario</name>
        <label>Obtener Usuario</label>
        <locationX>952</locationX>
        <locationY>1454</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>VisMed_ObtenerAPMContacto</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>VisMed_RecorrerUsuariosDeLaCola.UserOrGroupId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>User</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>VisMed_ActualizarEstadoObjetvo</name>
        <label>Actualizar Estado Objetvo</label>
        <locationX>578</locationX>
        <locationY>1094</locationY>
        <connector>
            <targetReference>VisMed_ListadoDeUsuarios</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Estado__c</field>
            <value>
                <elementReference>VisMed_AsignarEstadoObjetivoAccion</elementReference>
            </value>
        </inputAssignments>
        <object>VisMed_Objetivo__c</object>
    </recordUpdates>
    <recordUpdates>
        <name>VisMed_ActualizarOwner</name>
        <label>Actualizar Owner</label>
        <locationX>578</locationX>
        <locationY>854</locationY>
        <connector>
            <targetReference>VisMEd_PantallaConfirmacion</targetReference>
        </connector>
        <inputReference>VisMed_ObtenerObjetivo</inputReference>
    </recordUpdates>
    <screens>
        <name>Seleccionar_Valores</name>
        <label>Seleccionar Valores</label>
        <locationX>578</locationX>
        <locationY>278</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>VisMed_ColaAsignada</targetReference>
        </connector>
        <fields>
            <name>Instrucciones</name>
            <fieldText>&lt;p&gt;&lt;em style=&quot;color: rgb(68, 68, 68); background-color: rgb(255, 255, 255); font-size: 14px;&quot;&gt;Seleccionar el grupo al cual será asignado el objetivo&lt;/em&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>VisMed_AsignarObjetivo</name>
            <choiceReferences>ListaDeColas</choiceReferences>
            <dataType>String</dataType>
            <fieldText>Asignar Objetivo</fieldText>
            <fieldType>DropdownBox</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>VisMed_ObjetivosPorCuentaCreados</name>
        <label>Objetivos Por Cuenta Creados</label>
        <locationX>578</locationX>
        <locationY>2582</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <fields>
            <name>Mensaje_0</name>
            <fieldText>&lt;p style=&quot;text-align: center;&quot;&gt;&lt;em style=&quot;font-size: 14px; font-family: tahoma;&quot;&gt;Los objetivos por cuenta, fueron creados de forma correcta.&lt;/em&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>VisMEd_PantallaConfirmacion</name>
        <label>Pantalla de Confirmación</label>
        <locationX>578</locationX>
        <locationY>974</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>VisMed_ActualizarEstadoObjetvo</targetReference>
        </connector>
        <fields>
            <name>Mensaje</name>
            <fieldText>&lt;p style=&quot;text-align: center;&quot;&gt;&lt;em style=&quot;font-size: 14px; font-family: tahoma;&quot;&gt;El objetivo fue asignado a &lt;/em&gt;&lt;strong style=&quot;font-size: 14px; font-family: tahoma;&quot;&gt;&lt;em&gt;{!VisMed_AsignarObjetivo}&lt;/em&gt;&lt;/strong&gt;&lt;em style=&quot;font-size: 14px; font-family: tahoma;&quot;&gt; de manera correcta.&lt;/em&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <start>
        <locationX>452</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>VisMed_ObtenerObjetivo</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <variables>
        <name>apmcontact</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>Fecha</name>
        <dataType>Date</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>recordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
